---
title: " Linux - 信号"
categories: 操作系统
---
当进程打开一个文件的时候，内核会为其创建一个 struct file 结构来描述被打开的文件，并在进程文件描述符列表 fd_array 数组中找到一个空闲位置分配给它，数组中对应的下标，就是我们在用户空间用到的文件描述符

而 `struct file 结构是和进程相关`的（ fd 的作用域也是和进程相关的），即使多个进程打开同一个文件，那么***内核会为每一个进程创建一个 struct file 结构***，如上图中所示，进程 1 和 进程 2 都打开了同一个 file-read-write.txt 文件，那么内核会为进程 1 创建一个 struct file 结构，也会为进程 2 创建一个 struct file 结构。

每一个磁盘上的文件在内核中都会***有一个唯一的 struct inode 结构***，**inode 结构和进程是没有关系的**，一个文件在内核中只对应一个 inode，inode 结构用于描述文件的元信息，比如，文件的权限，文件中包含多少个磁盘块，每个磁盘块位于磁盘中的什么位置等等。

根据程序的时间局部性原理我们知道，磁盘文件中的数据一旦被访问，那么它很有可能在短期内被再次访问，所以为了加快进程对文件数据的访问，内核会将已经访问过的磁盘块缓存在文件页中。

一个文件包含多个磁盘块，当它们被读取到内存之后，**一个文件也就对应了多个文件页**，这些文件页在内存中统一被一个叫做 `page cache` 的结构所组织。

每***一个文件在内核中都会有一个唯一的 page cache 与之对应***，用于缓存文件中的数据，**page cache 是和文件相关的，它和进程是没有关系的**，多个进程可以打开同一个文件，每个进程中都有有一个 struct file 结构来描述这个文件，但是一个文件在内核中只会对应一个 page cache。